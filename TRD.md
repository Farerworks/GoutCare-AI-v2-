# TRD: 기술 요구사항 명세서 (GoutCare AI)

## 1. 시스템 개요

*   **아키텍처:** 백엔드 서버 없이 모든 로직이 브라우저에서 실행되는 순수 클라이언트 사이드 단일 페이지 애플리케이션 (SPA).
*   **장기 비전:** 현재 아키텍처는 신속한 프로토타이핑과 사용자 프라이버시 보호에 중점을 둔 초기 단계. 최종 목표인 **디지털 치료제(DTx)**로 발전하기 위해서는, 사용자 동의 하에 데이터를 수집하고 분석할 수 있는 **안전하고 확장 가능한 클라우드 백엔드 시스템으로의 전환**이 필수적.
*   **핵심 의존성:** 데이터 분석 및 자연어 처리는 Google의 Gemini API를 통해 비동기적으로 처리.
*   **데이터 저장소:** 모든 사용자 데이터(로그, 설정, 채팅 기록 등)는 브라우저의 `localStorage`에 JSON 형태로 저장되어 오프라인 접근성과 강력한 데이터 프라이버시를 보장.
*   **컴포넌트 구조:** 재사용성과 유지보수성을 극대화하기 위해 기능 기반의 모듈식 컴포넌트 아키텍처를 채택 (예: `components/dashboard` 폴더 내 개별 카드 컴포넌트 분리).

## 2. 기술 스택

| 분류 | 기술 | 명세 및 버전 | 선정 이유 |
| :--- | :--- | :--- | :--- |
| **프론트엔드** | React | 19.1.1 | 컴포넌트 기반 아키텍처를 통한 효율적인 UI 개발 및 선언적 상태 관리. |
| | TypeScript | 최신 | 정적 타입 검사를 통해 코드의 안정성, 가독성, 유지보수성 향상. |
| | Tailwind CSS | 최신 | 유틸리티 우선 CSS 프레임워크로 빠르고 일관된 반응형 UI 스타일링. |
| **AI 서비스** | Google Gemini API | `@google/genai@^1.15.0` | 멀티모달(텍스트, 이미지) 입력, 강력한 NLP, 구조화된 JSON 스키마 출력, 웹 검색 등 앱의 핵심 AI 기능 제공. |
| | Gemini 모델 | `gemini-2.5-flash` | 텍스트 기반 작업(채팅, 리포트, 예측) 및 이미지 분석을 위한 비용과 성능의 균형이 최적화된 모델. |
| **런타임** | 웹 브라우저 | 최신 브라우저 (Chrome, Safari, Edge 등) | `importmap`, ES Modules, Fetch API, `localStorage` 등 최신 웹 표준 활용. |

## 3. 아키텍처 및 데이터 흐름

*   **상태 관리:**
    *   애플리케이션의 전역 상태(`logs`, `chatHistory` 등)는 최상위 `App.tsx` 컴포넌트에서 `useState`와 커스텀 훅인 `useLocalStorage`를 사용하여 관리.
    *   `useLocalStorage` 훅은 상태 변경을 `localStorage`에 자동으로 동기화하여 데이터 영속성을 보장.
    *   상태와 상태 설정 함수는 Props Drilling을 통해 하위 컴포넌트로 전달. 현재 앱 규모에서는 직관적인 방식이나, 복잡도 증가 시 `React Context` 도입을 고려할 수 있음.

*   **데이터 저장소 (현재):**
    *   `localStorage`를 Key-Value 저장소로 사용 (예: `goutcare-logs`, `goutcare-prefs`).
    *   모든 데이터는 저장 전 `JSON.stringify()`, 조회 시 `JSON.parse()`를 거침.
    *   **장점:** 서버 비용 없음, 빠른 초기 로딩 속도, 오프라인 지원, 사용자 데이터가 외부에 전송되지 않아 프라이버시가 극대화됨.
    *   **단점 및 한계:**
        *   **연구 불가:** 데이터가 중앙 서버에 수집되지 않아 학술 연구 및 AI 모델 고도화를 위한 데이터 분석이 불가능.
        *   **데이터 유실 위험:** 브라우저 캐시 삭제 시 데이터가 영구적으로 유실됨 (데이터 내보내기 기능으로 일부 완화).
        *   **확장성 부재:** 기기 간 데이터 동기화가 불가능하여 사용자 경험에 한계.

*   **아키텍처 진화 방향 (향후):**
    *   학술 연구, 디지털 치료제 승인 및 글로벌 상용화 목표 달성을 위해, **서버리스 클라우드 아키텍처로의 전환**을 제안.
    *   **기술 제안:** Google Firebase (Firestore, Authentication, Cloud Functions) 또는 AWS Amplify.
    *   **기대 효과:**
        *   **중앙화된 데이터 수집:** 사용자 동의 하에 익명화된 데이터를 안전하게 수집하여 연구 및 분석에 활용.
        *   **데이터 동기화:** 사용자가 여러 기기에서 로그인하여 자신의 데이터를 일관되게 관리.
        *   **보안 및 규정 준수:** HIPAA, GDPR 등 의료 데이터 관련 규정을 준수하는 인프라 구축.
        *   **확장성:** 글로벌 사용자 증가에 유연하게 대응.

*   **Gemini API 연동 (`services/geminiService.ts`):**
    *   모든 Gemini API 호출은 `services/geminiService.ts` 모듈 내에 캡슐화하여 API 로직을 중앙에서 관리.
    *   **API 키 관리:** API 키는 `process.env.API_KEY` 환경 변수를 통해 안전하게 주입.
    *   **구조화된 데이터 추출 (JSON 모드):** `responseSchema`를 정의하고 Gemini API의 JSON 모드를 사용하여 AI 응답을 예측 가능한 TypeScript 타입으로 안정적으로 파싱.
    *   **멀티모달 처리:** 사용자 이미지를 Base64로 인코딩하여 텍스트 프롬프트와 함께 API로 전송.
    *   **대화형 AI (챗봇):** `ai.chats.create`를 사용하여 대화 히스토리를 관리.
    *   **외부 정보 (웹 검색):** `tools: [{ googleSearch: {} }]`를 포함하여 외부 정보 검색 및 출처 표시.
    *   **안전성 및 일관성:** `systemInstruction`을 통해 AI의 역할, 안전 규칙, 응답 언어를 정의.

## 4. 핵심 기능 기술 명세

*   **컴포넌트 아키텍처:**
    *   초기의 거대했던 컴포넌트(예: `Dashboard.tsx`)를 더 작고 기능 중심적인 단위로 분해하는 리팩토링을 수행.
    *   `components/dashboard` 디렉토리는 이제 `RiskAdvisorCard.tsx`, `DailySummaryCard.tsx` 등 각 카드/타일에 대한 개별 컴포넌트를 포함.
    *   결과적으로 `Dashboard.tsx`는 이제 이러한 자식 컴포넌트들을 조립하고 데이터를 전달하는 컨테이너 역할을 주로 담당하여, 코드 가독성과 유지보수성을 크게 향상시킴. 이 패턴은 앱 전체에 점진적으로 적용될 예정.

*   **사진 첨부 (증상, 식단):**
    *   `<input type="file" accept="image/*">` 요소를 사용하여 기기의 카메라나 갤러리에 접근.
    *   `FileReader` API의 `readAsDataURL()` 메소드를 통해 선택된 이미지 파일을 Base64 데이터 URL로 변환.
    *   이 Base64 문자열은 UI 미리보기를 제공하기 위해 상태에 저장되며, 로그를 저장하거나 Gemini API로 전송할 때 데이터 페이로드에 포함됨.

*   **데이터 관리 (내보내기/가져오기):**
    *   **내보내기:** `localStorage`의 모든 관련 키에서 데이터를 수집하여 단일 JSON 객체로 컴파일하고 `Blob`으로 변환. `URL.createObjectURL`을 사용하여 다운로드 링크를 생성하고, 이를 프로그래매틱하게 클릭하여 파일 다운로드를 트리거.
    *   **가져오기:** `<input type="file">`로 JSON 파일을 받음. `FileReader.readAsText()`로 내용을 읽고 `JSON.parse()`로 파싱한 후, `setLogs`, `setPreferences` 등 각각의 상태 업데이트 함수를 호출하여 앱에 데이터를 적용. `window.confirm` 대화 상자를 통해 사용자에게 기존 데이터 덮어쓰기를 경고.

## 5. 비기능적 요구사항

*   **성능:** 불필요한 리렌더링을 최소화하기 위해 `useMemo`와 `useCallback`을 적재적소에 사용. 과도한 메모리 사용을 방지하기 위한 효율적인 이미지 처리. 모든 API 호출에 대한 명확한 로딩 상태를 제공하여 사용자 경험 향상.
*   **보안:**
    *   **(현재):** `localStorage` 사용으로 데이터가 외부로 전송되지 않아 사용자 프라이버시가 높음.
    *   **(향후):** 클라우드 아키텍처 전환 시, **전송 중/저장 시 데이터 암호화, 안전한 사용자 인증, 데이터베이스 접근 제어** 등 의료 데이터를 다루기 위한 최고 수준의 보안 관행을 적용해야 함.
*   **반응형 디자인:** 모바일 우선 접근 방식을 따름. 화면 크기에 따라 레이아웃이 조정되어 모바일에서는 `BottomNavBar`를, 데스크톱(md 브레이크포인트 이상)에서는 `Sidebar`를 표시.
*   **접근성 (A11y):** 시맨틱 HTML 태그 사용. 모든 버튼과 상호작용 요소에 `aria-label` 및 기타 ARIA 속성을 제공하여 스크린 리더 사용자 지원.
*   **확장성:** 현재 아키텍처는 확장성이 제한됨. 향후 클라우드 기반 아키텍처는 글로벌 트래픽을 처리할 수 있도록 확장 가능해야 함.

## 6. 데이터 프라이버시, 보안 및 규정 준수 (향후 핵심 과제)

디지털 치료제로 발전하기 위해서는 다음 사항이 반드시 고려되고 구현되어야 한다.

*   **사용자 동의 (Informed Consent):**
    *   데이터 수집 및 연구 활용 목적에 대해 명확하고 이해하기 쉬운 언어로 설명하고, 사용자로부터 명시적인 동의를 얻는 절차를 구현해야 한다.
    *   사용자는 언제든지 자신의 동의를 철회할 수 있어야 한다.
*   **데이터 익명화 (Anonymization):**
    *   연구 및 분석에 사용되는 모든 데이터는 개인을 식별할 수 없도록 이름, 이메일 등 개인식별정보(PII)를 제거하고 비식별화(de-identification) 처리해야 한다.
*   **의료 정보보호 규정 준수:**
    *   서비스를 제공할 국가의 의료 데이터 관련 법규(예: 미국의 HIPAA, 유럽의 GDPR)를 철저히 준수하는 시스템을 설계하고 구축해야 한다.
    *   이는 데이터 저장, 접근 제어, 감사 로그 등 기술 아키텍처 전반에 걸쳐 반영되어야 한다.
